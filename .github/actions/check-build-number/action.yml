name: Check Build Number
description: Vergleicht, ob sich die Buildnummer in app.config.ts ge√§ndert hat

inputs:
  working-directory:
    required: false
    description: 'Das Verzeichnis, in dem sich die app.config.ts befindet'
    default: frontend/app

runs:
  using: "composite"
  steps:
    - name: üîÑ Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 2
        # Get the last 2 commits to compare the build number

    - name: üîç Vergleiche Buildnummer
      id: check
      run: |
        old=$(git show HEAD^:${{ inputs.working-directory }}/app.config.ts | grep -A 5 'function getBuildNumber' | grep 'return' | grep -Eo '[0-9]+' | head -1 || echo "not-found")
        new=$(cat ${{ inputs.working-directory }}/app.config.ts | grep -A 5 'function getBuildNumber' | grep 'return' | grep -Eo '[0-9]+' | head -1 || echo "not-found")
        echo "üì¶ Old build number: $old"
        echo "üì¶ New build number: $new"

        if [ "$old" = "not-found" ]; then
          echo "‚ö†Ô∏è Old build number not found, skipping comparison"
          echo "changed=skip" >> "$GITHUB_OUTPUT"
          exit 0
        fi

        if [ "$old" != "$new" ]; then
          echo "‚úÖ Build number changed"
          echo "changed=true" >> "$GITHUB_OUTPUT"
        else
          echo "üö´ Build number unchanged"
          echo "changed=false" >> "$GITHUB_OUTPUT"
        fi
      shell: bash


outputs:
  changed:
    description: 'true, wenn die Buildnummer sich ge√§ndert hat'
    value: ${{ steps.check.outputs.changed }}
